---
title: "Instances"
description: "Create and manage VM instances"
---

## Overview

Instances are VMs running the in10nt agent server. They provide isolated environments for executing AI coding tasks.

## Create Instance

```javascript
const instance = await client.instances.create({
  name: 'my-agent',
  description: 'My coding agent',
  agentType: 'opencode',          // 'opencode' or 'moltbot'
  templateId: 'tmpl_12345',       // Optional: custom template
  vmSize: 'shared-cpu-4x',        // Optional: VM size
  region: 'iad',                  // Optional: region
  env: { API_KEY: 'secret' }      // Optional: env vars
});
```

### Agent Types

| Type | Description | Min Size |
|------|-------------|----------|
| `opencode` | Default agent (OpenCode) | `shared-cpu-1x` |
| `moltbot` | Moltbot/Clawdbot agent | `shared-cpu-8x` (2GB) |

<Note>
  Moltbot requires at least 2GB RAM and automatically upgrades to `shared-cpu-8x` if needed
</Note>

### Parameters

| Parameter | Type | Description |
|-----------|------|-------------|
| `name` | `string` | **Required** - Instance name |
| `description` | `string` | **Required** - Description |
| `agentType` | `string` | Agent type: `opencode` or `moltbot` (default: `opencode`) |
| `templateId` | `string` | Container template ID |
| `vmSize` | `string` | VM size (default: `shared-cpu-4x`) |
| `region` | `string` | Region code (default: `iad`) |
| `env` | `object` | Environment variables |

### Response

```javascript
{
  instanceId: "inst_abc123",
  name: "my-agent",
  status: "healthy",
  agentUrl: "http://machine-id.vm.app.internal:3000",
  createdAt: "2025-01-06T..."
}
```

## Integrations

Connect your agent to external services:

```javascript
const instance = await client.instances.create({
  name: 'discord-bot',
  description: 'Discord bot agent',
  agentType: 'moltbot',  // Required for Discord
  integrations: ['Discord', 'GitHub'],
  integrationEnv: {
    DISCORD_BOT_TOKEN: 'xxx',
    DISCORD_GUILD_ID: 'xxx',
    DISCORD_CHANNEL_ID: 'xxx',
    GITHUB_TOKEN: 'xxx'
  }
});
```

### Supported Integrations

| Integration | Required Env Vars |
|-------------|-------------------|
| `Discord` | `DISCORD_BOT_TOKEN`, `DISCORD_GUILD_ID`, `DISCORD_CHANNEL_ID` |
| `Slack` | `SLACK_BOT_TOKEN` |
| `GitHub` | `GITHUB_TOKEN` |
| `Notion` | `NOTION_API_TOKEN` |
| `Telegram` | `TELEGRAM_BOT_TOKEN` |
| `Jira` | `JIRA_BASE_URL`, `JIRA_EMAIL`, `JIRA_API_TOKEN` |
| `Voice` | `TWILIO_ACCOUNT_SID`, `TWILIO_AUTH_TOKEN`, `TWILIO_FROM_NUMBER` |

<Note>
  Voice integration supports both Twilio (required) and ElevenLabs (optional). Add `ELEVENLABS_API_KEY`, `ELEVENLABS_VOICE_ID` for text-to-speech.
</Note>

<Warning>
  Discord integration only works with `agentType: 'moltbot'`
</Warning>

### Update Integrations

```javascript
// Update after creation
await client.client.post(`/instances/${instanceId}/integrations`, {
  integrations: ['GitHub', 'Notion'],
  integrationEnv: { GITHUB_TOKEN: 'new_token' }
});
```

## List Instances

Get all your instances:

```javascript
const instances = await client.instances.list();

instances.forEach(instance => {
  console.log(`${instance.name}: ${instance.status}`);
});
```

## Get Instance

Retrieve a specific instance by ID:

```javascript
const instance = await client.instances.get('inst_abc123');
```

Or by name:

```javascript
const instance = await client.instances.getByName('my-agent');
```

## Run Task

Execute a coding task on an instance (works for both OpenCode and Moltbot):

```javascript
const result = await instance.run(
  'Build a REST API with user CRUD operations',
  {
    model: 'anthropic/claude-sonnet-4.5',  // Optional
    provider: 'openrouter',                 // Optional
    timeout: 480000,                        // Optional: 8 minutes
    system: 'Custom system prompt'          // Optional
  }
);

console.log(result.response);
console.log(`Tokens used: ${result.tokensUsed}`);
console.log(`Duration: ${result.duration_ms}ms`);
```

<Note>
  The same `.run()` method works for both OpenCode and Moltbot instances. Moltbot instances automatically use optimized internal routing.
</Note>

### Complete Example with All Options

```javascript
// Works for both OpenCode and Moltbot
const result = await instance.run(
  'Build a REST API with authentication',
  {
    model: 'anthropic/claude-sonnet-4.5',
    provider: 'openrouter',
    max_tokens: 8000,
    system: 'You are a senior backend engineer',
    timeout: 600000,        // 10 minutes
    autoTools: true,        // Enable automatic tools
    async: false            // Synchronous execution
  }
);
```

### Options

| Option | Type | Default | Description |
|--------|------|---------|-------------|
| `model` | `string` | `anthropic/claude-sonnet-4.5` | LLM model |
| `provider` | `string` | `openrouter` | Model provider |
| `max_tokens` | `number` | - | Max response tokens |
| `system` | `string` | - | Custom system prompt |
| `timeout` | `number` | `480000` | Timeout in ms (8 min default) |
| `tools` | `array` | - | Custom tools for the agent |
| `autoTools` | `boolean` | `true` | Enable automatic tool usage |
| `async` | `boolean` | `false` | Run task asynchronously |

## Async Tasks

Tasks run asynchronously and return a `taskId` for polling:

```javascript
// Start task (returns immediately)
const response = await instance.run('Build a web app');

if (response.taskId) {
  // Poll until complete
  const result = await instance.pollTask(response.taskId);
  console.log(result.response);
}
```

### Poll Task

```javascript
const result = await instance.pollTask(taskId, {
  pollInterval: 2000,    // Check every 2s
  maxPollTime: 600000    // Timeout after 10min
});
```

### Get Task Status

```javascript
// Single status check (no polling)
const status = await instance.getTaskStatus(taskId);
// Returns: { status: 'processing' | 'completed' | 'failed' }
```

### List Tasks

```javascript
const tasks = await instance.listTasks();
// Returns: { tasks: [{ taskId, status, createdAt }] }
```

## Conversation Context

Instance maintains conversation history automatically. You can send multiple prompts:

```javascript
const instance = await client.instances.create({ name: 'web-builder' });

// First prompt
await instance.run('Create a simple REST API with user CRUD');

// Follow-up prompts (context maintained)
await instance.run('Add JWT authentication');
await instance.run('Add rate limiting middleware');
await instance.run('Write integration tests');
```

## Instance Management

### Health Check

Check if instance is ready:

```javascript
const health = await instance.health();
console.log(health.status); // "healthy"
```

### Get Changes

Get files modified by the instance:

```javascript
const changes = await instance.getChanges();
console.log('Modified files:', changes.changes);
```

### Refresh Status

Update instance data:

```javascript
await instance.refresh();
console.log(`Current status: ${instance.status}`);
```

### Stop Instance

```javascript
await instance.stop();
```

### Restart Instance

Recreate a destroyed machine:

```javascript
await client.client.post(`/instances/${instanceId}/restart`);
// Recreates machine, reuses volume if available
```

### Destroy Instance

```javascript
await instance.destroy();
```

<Warning>
  Destroy is permanent. Use `stop()` if you plan to restart later.
</Warning>

## Snapshots

Save and restore workspace state:

```javascript
// Create snapshot
const snapshot = await client.client.post(
  `/instances/${instanceId}/snapshot`
);

// Restore from snapshot
const instance = await client.instances.create({
  name: 'restored',
  description: 'Restored workspace',
  snapshotId: snapshot.snapshotId
});
```

## Ports & Proxying

Access dev servers running in your instance:

```javascript
// Discover active ports
const ports = await client.client.get(`/instances/${instanceId}/ports`);
// Returns: { ports: [5173, 3000], proxyPattern: '...' }

// Access via proxy URL
const url = `https://in10t-api-v2.fly.dev/instances/${instanceId}/ports/5173/`;
```

### Register Ports Manually

```javascript
await client.client.post(`/instances/${instanceId}/open-ports`, {
  ports: [5173, 3000, 8080]
});
```

## Save & Clone Instance

Save instance workspace as reusable template:

```javascript
// Save (requires Firestore config)
const saved = await instance.save('my-template');

// Clone later
const clone = await client.instances.createFromTemplate({
  templateName: 'my-template',
  newInstanceName: 'new-instance'
});
```

<Note>
  Requires `db` and `userId` in client config. Different from container templates.
</Note>

## Filesystem

Get workspace file tree:

```javascript
const tree = await client.client.get(
  `/instances/${instanceId}/filesystem?depth=10`
);
```

## Stream Logs

```javascript
// Node.js: install 'eventsource' package first
const stopStreaming = await instance.streamLogs((log) => {
  console.log(`[${log.type}] ${log.message}`);
});

await instance.run('Build a web app');
stopStreaming();
```

## Quick Examples

### Basic Usage

```javascript
const instance = await client.instances.create({
  name: 'my-agent',
  description: 'Quick task'
});

await instance.run('Create a REST API');
await instance.destroy();
```

### Multi-Step Session

```javascript
const instance = await client.instances.create({
  name: 'session',
  description: 'Multi-step project'
});

await instance.run('Initialize project');
await instance.run('Add authentication');
await instance.run('Write tests');

const changes = await instance.getChanges();
await instance.destroy();
```

### Discord Bot (Moltbot)

```javascript
const bot = await client.instances.create({
  name: 'discord-bot',
  description: 'My Discord bot',
  agentType: 'moltbot',
  integrations: ['Discord'],
  integrationEnv: {
    DISCORD_BOT_TOKEN: process.env.DISCORD_TOKEN,
    DISCORD_GUILD_ID: '123456',
    DISCORD_CHANNEL_ID: '789012'
  }
});

// Bot automatically responds to Discord messages
// You can also run tasks directly via HTTP:
await bot.run('Add a /help command that lists all available features');
```

### Voice Agent (Twilio + ElevenLabs)

```javascript
const voiceAgent = await client.instances.create({
  name: 'voice-assistant',
  description: 'Voice-enabled AI agent',
  integrations: ['Voice'],
  integrationEnv: {
    TWILIO_ACCOUNT_SID: process.env.TWILIO_ACCOUNT_SID,
    TWILIO_AUTH_TOKEN: process.env.TWILIO_AUTH_TOKEN,
    TWILIO_FROM_NUMBER: '+1234567890',
    ELEVENLABS_API_KEY: process.env.ELEVENLABS_KEY,
    ELEVENLABS_VOICE_ID: 'voice_id_here'
  }
});
```

### Moltbot with Custom Options

```javascript
const moltbot = await client.instances.create({
  name: 'custom-moltbot',
  description: 'Moltbot with custom settings',
  agentType: 'moltbot'
});

// Run task with custom options (same API as OpenCode)
const result = await moltbot.run(
  'Analyze this codebase and suggest improvements',
  {
    model: 'anthropic/claude-sonnet-4.5',
    max_tokens: 16000,
    timeout: 900000  // 15 minutes for complex tasks
  }
);
```

---

## HTTP API Reference

Base URL: `https://in10t-api-v2.fly.dev`  
Auth: `Authorization: Bearer YOUR_API_KEY` or `X-API-Key: YOUR_API_KEY`

### Create Instance

```bash
curl -X POST https://in10t-api-v2.fly.dev/instances \
  -H "Authorization: Bearer YOUR_API_KEY" \
  -H "Content-Type: application/json" \
  -d '{
    "name": "my-agent",
    "description": "My coding agent",
    "agentType": "opencode",
    "region": "iad",
    "vmSize": "shared-cpu-4x"
  }'
```

### List Instances

```bash
curl -H "Authorization: Bearer YOUR_API_KEY" \
  https://in10t-api-v2.fly.dev/instances
```

### Get Instance

```bash
curl -H "Authorization: Bearer YOUR_API_KEY" \
  https://in10t-api-v2.fly.dev/instances/{instanceId}
```

### Run Task (OpenCode & Moltbot)

```bash
curl -X POST https://in10t-api-v2.fly.dev/instances/{instanceId}/run \
  -H "Authorization: Bearer YOUR_API_KEY" \
  -H "Content-Type: application/json" \
  -d '{
    "prompt": "Build a REST API with user CRUD",
    "model": "anthropic/claude-sonnet-4.5",
    "timeout": 480000,
    "max_tokens": 8000
  }'
```

| Body Param | Type | Required | Description |
|------------|------|----------|-------------|
| `prompt` | string | Yes | Task prompt |
| `model` | string | No | LLM model (default: anthropic/claude-sonnet-4.5) |
| `provider` | string | No | Model provider (default: openrouter) |
| `timeout` | number | No | Timeout in ms (default: 480000) |
| `max_tokens` | number | No | Max response tokens |
| `system` | string | No | Custom system prompt |
| `async` | boolean | No | Run asynchronously |

### Stop Instance

```bash
curl -X POST https://in10t-api-v2.fly.dev/instances/{instanceId}/stop \
  -H "Authorization: Bearer YOUR_API_KEY"
```

### Destroy Instance

```bash
curl -X DELETE https://in10t-api-v2.fly.dev/instances/{instanceId} \
  -H "Authorization: Bearer YOUR_API_KEY"
```

### Restart Instance

```bash
curl -X POST https://in10t-api-v2.fly.dev/instances/{instanceId}/restart \
  -H "Authorization: Bearer YOUR_API_KEY"
```

### Get Health

```bash
curl -H "Authorization: Bearer YOUR_API_KEY" \
  https://in10t-api-v2.fly.dev/instances/{instanceId}/health
```

### Get Changes

```bash
curl -H "Authorization: Bearer YOUR_API_KEY" \
  "https://in10t-api-v2.fly.dev/instances/{instanceId}/changes"
```

### Execute Command

```bash
curl -X POST https://in10t-api-v2.fly.dev/instances/{instanceId}/execute \
  -H "Authorization: Bearer YOUR_API_KEY" \
  -H "Content-Type: application/json" \
  -d '{"command": "ls -la /workspace"}'
```

### List Tasks

```bash
curl -H "Authorization: Bearer YOUR_API_KEY" \
  https://in10t-api-v2.fly.dev/instances/{instanceId}/tasks
```

### Get Task Status

```bash
curl -H "Authorization: Bearer YOUR_API_KEY" \
  https://in10t-api-v2.fly.dev/instances/{instanceId}/tasks/{taskId}
```

